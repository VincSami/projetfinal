"use strict";var ikea=window.ikea||{};ikea.getSession(function(e,t){var i=t.userId||localStorage.session_ca||"",a=null;ikea.iows=function(){var e={baseUrl:"https://iows.ikea.com",country:"ca",locale:"en",consumer:"MAMMUT",contract:"37249"};function n(e){e.call(this,i)}function o(e){n(function(t){a?e.call(this,a):r("customer/irw/"+t+"/shoppingbags/onlineshoppingcart",function(t){void 0!==t.ShoppingBagRefList.ShoppingBagRef?(a=t.ShoppingBagRefList.ShoppingBagRef.BagId.$,e.call(this,a)):(a=null,e.call(this,null))})})}function m(){var t;t=function(t){var i=document.querySelectorAll(".header__shopping-bag-quantity"),a=new Date;a.setTime(a.getTime()+31536e6);var n="; expires="+a.toUTCString();if(document.cookie="IRMW_CART_COUNT_"+e.country.toUpperCase()+"="+t+n+"; domain=.ikea.com; path=/",i.length>0){i[i.length-1].textContent=t}else{var o=document.getElementsByClassName("js-shopping-cart-icon");o&&(o[0].innerHTML+='<span class="header__shopping-bag-quantity">'+t+"</span>")}},n(function(){o(function(){null!==a?r("customer/irw/"+i+"/shoppingbags/onlineshoppingcart/"+a,function(e){var i=0,a=e.ShoppingBag.ShoppingBagSectionList.ShoppingBagSection.ShoppingBagItemList;void 0!==a.ShoppingBagItem&&(Array.isArray(a.ShoppingBagItem)?a.ShoppingBagItem.forEach(function(e){i+=e.ItemQty.$}):i+=a.ShoppingBagItem.ItemQty.$),t.call(this,i)}):t.call(this,0)})})}function r(t,i,a,n){var o=-1!==t.indexOf("sessioncontext")?"1.0":"2.0",m=new XMLHttpRequest;t=e.baseUrl+"/retail/iows/"+e.country+"/"+e.locale+"/"+t,void 0===n&&(n="GET"),m.open(n,t),m.setRequestHeader("accept","application/vnd.ikea.iows+json; version="+o),m.setRequestHeader("consumer",e.consumer),m.setRequestHeader("contract",e.contract),m.withCredentials=!0,m.onload=function(){var e=null;if(200===m.status){try{e=JSON.parse(m.responseText)}catch(t){e=m.responseText}i.call(this,e)}},a?m.send("list="+JSON.stringify(a)):m.send()}return{setConfig:function(t){for(var i in t)e[i]=t[i]},getShoppingBag:function(e){n(function(){o(function(){null!==a?r("customer/irw/"+i+"/shoppingbags/onlineshoppingcart/"+a,function(t){var i=t.ShoppingBag.ShoppingBagSectionList.ShoppingBagSection.ShoppingBagItemList;if(void 0!==i.ShoppingBagItem){var a=[],n={},o=function(e){var t=e.ItemNo.$;"SPR"===e.ItemType.$&&(t="S"+t),n[e.ItemNo.$]=e.ItemQty.$,a.push(t.toString())};Array.isArray(i.ShoppingBagItem)?i.ShoppingBagItem.forEach(function(e){o(e)}):o(i.ShoppingBagItem),ikea.iows.getProducts(a,function(t){t.forEach(function(e){e.quantity=n[e.itemNo]}),e.call(this,t)})}else e.call(this,[])}):e.call(this,[])})})},getProducts:function(t,i){var a="";t.forEach(function(e){var t;a+=(t=(t=e).replace(/[^0-9]/g,""),9==parseInt(t[1])?"spr,"+t+";":"art,"+t+";")}),a=a.slice(0,-1);var n=function(t){var i,a,n={itemNo:t.ItemNo.$.toString(),itemType:t.ItemType.$,name:t.ProductName?t.ProductName.$:"",type:t.ProductTypeName?t.ProductTypeName.$:"",design:t.ValidDesignText?t.ValidDesignText.$:"",sellable:!!t.OnlineSellable&&t.OnlineSellable.$,bti:Boolean(t.BreathTakingItem.$),new:!(!t.NewsType||"ICON"!==t.NewsType.$),rating:!!(t.RetailItemRating&&t.RetailItemRating.ItemRating&&t.RetailItemRating.ItemRating.AverageRating.$)&&t.RetailItemRating.ItemRating.AverageRating.$,reviews:!!(t.RetailItemRating&&t.RetailItemRating.ItemRating&&t.RetailItemRating.ItemRating.Count.$)&&t.RetailItemRating.ItemRating.Count.$};if(n.link=(a="SPR"===(i=n).itemType?"s":"","https://www.ikea.com/"+e.country+"/"+e.locale+"/p/"+_.deburr((i.name+"-"+i.type+"-"+i.design).replace(" ","").toLowerCase())+"-"+a+i.itemNo+"/"),t.RetailItemCommPriceList&&t.RetailItemCommPriceList.RetailItemCommPrice){var o=t.RetailItemCommPriceList.RetailItemCommPrice;Array.isArray(o)?o.forEach(function(e){"RegularSalesUnitPrice"===e.RetailPriceType.$?e.ReasonCode&&e.ReasonCode.$&&"TimeRestrictedOffer"===e.ReasonCode.$?(n.troprice=e.Price.$,e.ValidFromDateTime.$&&e.ValidToDateTime.$&&(n.trostart=e.ValidFromDateTime.$,n.troend=e.ValidToDateTime.$)):n.price=e.Price.$:"IKEAFamilySalesUnitPrice"===e.RetailPriceType.$&&(n.familyprice=e.Price.$,e.ValidFromDateTime.$&&e.ValidToDateTime.$&&(n.familystart=e.ValidFromDateTime.$,n.familyend=e.ValidToDateTime.$))}):n.price=o.Price.$}if(t.RetailItemImageList&&t.RetailItemImageList.RetailItemImage.length>0)for(var m=0;m<t.RetailItemImageList.RetailItemImage.length;m++){var r=t.RetailItemImageList.RetailItemImage[m];if("S2"===r.ImageSize.$&&r.ImageUrl.$){n.thumbnail="https://www.ikea.com"+r.ImageUrl.$;break}!n.thumbnail&&"S5"===r.ImageSize.$&&r.ImageUrl.$&&(n.thumbnail="https://www.ikea.com"+r.ImageUrl.$+"?f=xxxs")}return n};r("catalog/items/"+encodeURIComponent(a)+"?ignoreErrors=true",function(e){var t=[];if(e.RetailItemCommList&&e.RetailItemCommList.RetailItemComm)for(var a=0;a<e.RetailItemCommList.RetailItemComm.length;a++)t.push(n(e.RetailItemCommList.RetailItemComm[a]));else e.RetailItemComm&&t.push(n(e.RetailItemComm));i.call(this,t)})},retrieveSessonContext:function(){return t},addToCart:function(e,t){n(function(){o(function(){var n={ShoppingBagAdjustmentItemList:{ShoppingBagAdjustmentItem:[],"@xmlns":{$:"ikea.com/cem/iows/ShoppingBagService/2.0/"}}},o={ShoppingBag:{BagType:{$:"onlineshoppingcart"},BagSource:{$:"M2"},BagName:{$:"CART"},CustomerSource:{$:"M2"},CustomerId:{},CreatedDateTime:{$:(new Date).toUTCString()},ShoppingBagSectionList:[{ShoppingBagSection:{ShoppingBagItemList:{ShoppingBagItem:[]}}}],"@xmlns":{$:"ikea.com/cem/iows/ShoppingBagService/2.0/"}}};e.forEach(function(e){var t=e.itemNo.charAt(0);"s"===t?(t=t.replace("s",""),t="SPR"):t="ART",console.log({ItemType:{$:t},ItemNo:{$:e.itemNo},ItemQty:{$:e.quantity},SectionId:{$:0}}),n.ShoppingBagAdjustmentItemList.ShoppingBagAdjustmentItem.push({ItemType:{$:t},ItemNo:{$:e.itemNo},ItemQty:{$:e.quantity},SectionId:{$:0}}),o.ShoppingBag.ShoppingBagSectionList[0].ShoppingBagSection.ShoppingBagItemList.ShoppingBagItem.push({ItemType:{$:t},ItemNo:{$:e.itemNo},ItemQty:{$:e.quantity}})}),null!==a?r("customer/irw/"+i+"/shoppingbags/onlineshoppingcart/"+a+"/items",function(e){m(),t.call(this,e)},n,"PUT"):r("customer/irw/"+i+"/shoppingbags/onlineshoppingcart",function(e){m(),t.call(this,e)},o,"POST")})})}}}()}),console.log("ðŸ›’ Cart functions initialized");